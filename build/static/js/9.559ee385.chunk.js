(this.webpackJsonplowympact=this.webpackJsonplowympact||[]).push([[9],{114:function(e,t,a){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}a.d(t,"a",(function(){return n}))},149:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(114);function r(e,t){if(e){if("string"===typeof e)return Object(n.a)(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(n.a)(e,t):void 0}}},325:function(e,t,a){},342:function(e,t,a){"use strict";a.r(t);var n=a(114);var r=a(149);function s(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(r.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=a(12),o=a(15),i=a(14),d=a(13),l=a(0),u=a(2),b=a(1);var h=function(){return Object(b.jsx)("div",{children:"Changer mot de passe"})},j=a(44),p=a(43),m=a(42),g=(a(325),{id:0,email:"bububu@bababa.com",password:"123456"}),f=a(55),v=a.n(f),x=a(16);var O=function(e){Object(i.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChange=function(e){e.preventDefault();var t=n.state,a=t.currentPassword,r=t.newPassword,s=function(e,t){var a=[];return e.length<6&&a.push(Object(b.jsx)("p",{children:"Entre un mot de passe. 6 caract\xe8res minimum requis"})),e!==t&&a.push(Object(b.jsx)("p",{children:"Les mots de passe ne correspondent pas"})),a}(r,t.confirmPassword);n.setState({errors:s}),0===s.length&&n.changeUserInfo(n.state.user._id,a,r)},n.changeUserInfo=function(e,t,a){fetch("https://api.lowympact.fr/api/v1/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json","api-key":"99d8fb95-abdd-4885-bf6c-3a81d8874043",authorization:localStorage.getItem("token")},body:JSON.stringify({currentPassword:t,newPassword:a})}).then((function(e){return e.json()})).then((function(e){!1===e.success?n.setState({errors:[].concat(s(n.state.errors),[e.error])}):n.setState({redirect:!0})}))},n.Verify=function(){var e=!0,t=localStorage.getItem("token");if(t){var a=v.a.decode(t,{complete:!0}),r=new Date;a.payload.exp>=r.getTime()/1e3&&(e=!1)}!0===e&&n.setState({redirect:!0})},n.componentDidMount=function(){n.Verify();var e=localStorage.getItem("userId");e&&n.loadUserInfo(e)},n.loadUserInfo=function(e){fetch("https://api.lowympact.fr/api/v1/users/".concat(e),{method:"GET",headers:{"Content-Type":"application/json","api-key":"99d8fb95-abdd-4885-bf6c-3a81d8874043",authorization:localStorage.getItem("token")}}).then((function(e){return e.json()})).then((function(e){n.setState({user:e.data})}))},n.state={user:g,currentPassword:"",newPassword:"",confirmPassword:"",errors:[],redirect:!1},n}return Object(o.a)(a,[{key:"render",value:function(){var e=this;return this.state.redirect?Object(b.jsx)(u.a,{to:"/profil"}):Object(b.jsxs)("div",{className:"screen",children:[Object(b.jsx)(x.b,{to:"/",children:Object(b.jsx)(p.a,{})}),Object(b.jsx)(m.a,{}),Object(b.jsx)("div",{className:"logo-fruits",children:Object(b.jsx)("img",{src:j.a,className:"logo",alt:"Fruits"})}),Object(b.jsx)(x.b,{className:"back-button",to:"/profil",children:"< Retour"}),Object(b.jsx)("div",{className:"configuration-screen-title"}),Object(b.jsx)("div",{className:"errors-change-password",children:this.state.errors}),Object(b.jsxs)("div",{className:"configuration-container",children:[Object(b.jsxs)("div",{className:"configuration-email-block",children:[Object(b.jsx)("div",{children:"email"}),Object(b.jsx)("div",{children:this.state.user.email})]}),Object(b.jsxs)("form",{className:"configuration-form",children:[Object(b.jsx)("label",{children:Object(b.jsx)("input",{placeholder:"mot de passe actuel",className:"input-forms",value:this.state.currentPassword,onChange:function(t){return e.setState({currentPassword:t.target.value})},type:"password"})}),Object(b.jsx)("label",{children:Object(b.jsx)("input",{value:this.state.newPassword,className:"input-forms",onChange:function(t){return e.setState({newPassword:t.target.value})},type:"password",placeholder:"nouveau mot de passe"})}),Object(b.jsx)("label",{children:Object(b.jsx)("input",{placeholder:"confirmation de mdp",className:"input-forms",value:this.state.confirmPassword,onChange:function(t){return e.setState({confirmPassword:t.target.value})},type:"password"})}),Object(b.jsx)(x.b,{className:"button-change-password",onClick:this.handleChange,to:"",children:Object(b.jsx)(h,{})})]})]})]})}}]),a}(l.Component);t.default=O},41:function(e,t,a){"use strict";t.a=a.p+"static/media/logo.b235ef42.svg"},42:function(e,t,a){"use strict";var n=a(12),r=a(15),s=a(14),c=a(13),o=(a(49),a(0)),i=a.n(o),d=(a(50),a(1));var l=function(){return Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{className:"button-logo",children:Object(d.jsx)("span",{className:"material-icons",children:"history"})}),Object(d.jsx)("div",{children:"Historique"})]})};var u=function(){return Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{children:Object(d.jsx)("span",{className:"material-icons",children:"person"})}),Object(d.jsx)("div",{children:"Profil"})]})};var b=function(){return Object(d.jsx)("div",{children:Object(d.jsx)("div",{className:"navbar-scan-icon",children:Object(d.jsx)("span",{className:"material-icons",children:"qr_code_scanner"})})})},h=a(39),j=a.n(h),p=a(40),m=a(80),g=a(81),f=a.n(g),v=a(82),x=a.n(v),O=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={error:!1,noBackCamera:!1,usedCamera:0,devices:[],processingImage:0,text:0,mutlipleTracks:!1,no_permission:!1},e.switchCamera=function(){var t=e.state.usedCamera+1;t>=e.state.devices.length&&(t=0),e.setState({usedCamera:t}),f.a.stop(),e.QuaggaInit(e.state.devices[t].deviceId)},e.componentDidMount=Object(p.a)(j.a.mark((function t(){var a,n,r,s,c,o;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a=window.location.search,n=new URLSearchParams(a),"false"!=n.get("camera")){t.next=8;break}e.setState({error:!0,text:1}),t.next=25;break;case 8:if(!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)){t.next=24;break}return t.next=11,navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"videoinput"===e.kind}))}));case 11:return r=t.sent,e.setState({devices:r}),0===(s=r.filter((function(e){return null!=e.label.match(/back/)}))).length&&(e.setState({noBackCamera:!0}),s=r),console.log(s),c=s.map(function(){var t=Object(p.a)(j.a.mark((function t(a){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:a.deviceId}}}).then((function(t){var a=t.getVideoTracks().map((function(e){return console.log(e),e.getCapabilities?e.getCapabilities():[{}]}));return t.getTracks().forEach((function(e){return e.stop()})),a.length>1&&e.setState({mutlipleTracks:!0}),a&&a.length>0?a[0]:{}}),(function(e){return console.log(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=19,Promise.all(c);case 19:(o=t.sent)&&o.length>0&&o.sort((function(e,t){return(e.width.max+e.height.max)/2>(t.width.max+t.height.max)/2?-1:1})),o[0]?e.QuaggaInit(o[0]):e.QuaggaInit({facingMode:"environment"}),t.next=25;break;case 24:e.setState({error:!0,text:3});case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(0),e.QuaggaInit({facingMode:"environment"});case 30:case"end":return t.stop()}}),t,null,[[0,27]])}))),e.QuaggaInit=function(t){console.log(t),0==Object.keys(t).length&&e.setState({text:"vide"}),f.a.init({inputStream:{type:"LiveStream",constraints:Object(m.a)({},t)},locator:{patchSize:"normal",halfSample:!1},locate:!1,area:{top:"40%",right:"25%",left:"25%",bottom:"40%"},numOfWorkers:window.navigator.hardwareConcurrency||2,decoder:{readers:["ean_reader"]},multiple:!1,singleChannel:!1},(function(a){if(a)return console.log(a),"NotAllowedError: Permission denied"==a&&e.setState({no_permission:!0}),e.setState({error:!0,text:a+" "+JSON.stringify(t)}),!1;f.a.start()})),e.props.setQuagga(f.a),console.log(f.a.CameraAccess),f.a.onDetected(e._onDetected)},e._onDetected=function(){var t=Object(p.a)(j.a.mark((function t(a){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.onDetected(a);case 2:n=t.sent,console.log(n),n&&f.a.stop();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onDrop=function(t){try{if(1!=e.state.processingImage){e.setState({processingImage:1}),console.log(t[t.length-1]);var a=new FileReader;a.readAsDataURL(t[t.length-1]),a.onloadend=function(){f.a.decodeSingle({decoder:{readers:["ean_reader"]},locate:!0,src:a.result},(function(t){var a;(console.log(t),t)?(e._onDetected(t),e.setState({processingImage:2}),console.log("result",null===(a=t.codeResult)||void 0===a?void 0:a.code)):(console.log("not detected"),e.setState({processingImage:3}))}))}}}catch(n){console.log(n),e.setState({processingImage:4})}},e.setImport=function(){e.setState({error:!e.state.error})},e}return Object(r.a)(a,[{key:"componentWillUnmount",value:function(){f.a.offDetected(this._onDetected)}},{key:"render",value:function(){var e=Object(d.jsx)(i.a.Fragment,{});return 1==this.state.processingImage&&(e=Object(d.jsx)(i.a.Fragment,{children:Object(d.jsx)("p",{children:"Chargement en cours..."})})),2==this.state.processingImage&&(e=Object(d.jsx)(i.a.Fragment,{children:Object(d.jsx)("p",{children:"Ce produit n'existe pas dans la base de donn\xe9es"})})),3==this.state.processingImage&&(e=Object(d.jsx)(i.a.Fragment,{children:Object(d.jsx)("p",{children:"Code barre non trouv\xe9 sur l'image, merci de r\xe9essayer"})})),4==this.state.processingImage&&(e=Object(d.jsx)(i.a.Fragment,{children:Object(d.jsxs)("p",{children:["Mauvais format ou fichier trop grand, merci de r\xe9essayer. ",Object(d.jsx)("br",{}),"Taille max : 5mb ",Object(d.jsx)("br",{}),"Formats: jpg, png, gif"]})})),Object(d.jsx)(i.a.Fragment,{children:Object(d.jsxs)("div",{className:"interactive-wrapper",children:[Object(d.jsx)("div",{id:"interactive",className:this.state.error?"hidden":"viewport"}),Object(d.jsx)("button",{className:"code-switch-camera",onClick:this.setImport,children:Object(d.jsx)("span",{className:"material-icons green",children:"cameraswitch"})}),this.state.error?Object(d.jsxs)("div",{className:"scan-error",children:[Object(d.jsx)(x.a,{withIcon:!0,withPreview:!1,buttonText:Object(d.jsxs)("div",{className:"button-import",children:[Object(d.jsx)("div",{className:"material-icons",children:"add_a_photo"}),Object(d.jsx)("p",{children:"Prendre une photo"})]}),onChange:this.onDrop,label:"",imgExtension:[".jpg",".gif",".png",".jpeg"],maxFileSize:5242880,labelClass:"import-label"}),Object(d.jsx)("p",{className:"red",children:e}),Object(d.jsxs)("p",{className:"error-message-import",children:[this.state.no_permission?Object(d.jsx)("div",{className:"no-permission",children:"L'acc\xe8s \xe0 votre cam\xe9ra est bloqu\xe9 : Vous pouvez l'autoriser dans les param\xe8tres de votre navigateur pour acc\xe9der au scanner"}):Object(d.jsx)(i.a.Fragment,{}),Object(d.jsx)("br",{})]})]}):Object(d.jsx)(i.a.Fragment,{}),this.state.mutlipleTracks?Object(d.jsx)("h1",{className:"debug",children:"If you see this, tell me"}):"",Object(d.jsx)("div",{className:"debug",children:this.state.text})]})})}}]),a}(o.Component),w=a(83),y=a.n(w),S=(a(84),a(2)),k=(a(51),function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={scanning:!0,status:"",results:[],usedCameraId:"3f6fc4177028f25c3e8215f4444838450630b8d656c627ef511346545d37f302",devices:[],reading:!1,barcode:void 0,bcProductId:void 0,Quagga:void 0},e.setQuagga=function(t){e.state.Quagga&&e.state.Quagga.stop(),e.setState({Quagga:t})},e._scan=function(){e.setState({scanning:!e.state.scanning,status:""})},e._onDetected=function(){var t=Object(p.a)(j.a.mark((function t(a){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=18;break}if(!a.codeResult||!a.codeResult.code){t.next=18;break}return e.setState({results:[a],scanning:!0,status:"waiting"}),t.next=5,fetch("https://world.openfoodfacts.org/api/v0/product/".concat(a.codeResult.code,".json/"));case 5:return n=t.sent,t.next=8,n.json();case 8:if(0===t.sent.status){t.next=16;break}return e.setState({scanning:!1,status:"found",barcode:a.codeResult.code}),e.props.showScanner(!1),e.state.Quagga&&e.state.Quagga.stop(),t.abrupt("return",!0);case 16:return e.setState({scanning:!0,status:"not found"}),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleScan=function(t){if(t){var a=t.split("/");a.length>1&&e.setState({scanning:!1,barcode:a[4],bcProductId:a[5],status:"found"}),e.state.Quagga&&e.state.Quagga.stop()}},e.handleError=function(e){console.error(e)},e.displayQrCode=function(){return"found"!==e.state.status?Object(d.jsx)(y.a,{delay:300,onError:e.handleError,onScan:e.handleScan,style:{width:"100%"},showViewFinder:!1}):Object(d.jsx)(i.a.Fragment,{})},e.displayBarCode=function(){return"found"!==e.state.status?Object(d.jsxs)(i.a.Fragment,{children:[Object(d.jsx)("div",{className:"header",children:Object(d.jsx)("ul",{className:"results",children:e.state.results.map((function(t,a){var n;return Object(d.jsxs)("div",{children:["waiting"===e.state.status?"V\xe9rification du code : "+(null===t||void 0===t||null===(n=t.codeResult)||void 0===n?void 0:n.code):"","not found"===e.state.status?"Code non trouv\xe9, merci de r\xe9essayer":""]},t.codeResult.code+a)}))})}),e.state.scanning?Object(d.jsx)(O,{onDetected:e._onDetected,setQuagga:e.setQuagga,usedCameraId:e.usedCameraId}):null]}):Object(d.jsx)(i.a.Fragment,{})},e.switchReader=function(){e.state.reading?e.setState({reading:!1}):(e.state.Quagga&&e.state.Quagga.stop(),e.setState({reading:!0}))},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this;return this.state.barcode&&this.state.bcProductId&&(this.props.barcode!==this.state.barcode||this.props.bcProductId!==this.state.bcProductId)?Object(d.jsx)(S.a,{to:"/products/"+this.state.barcode+"/"+this.state.bcProductId}):this.state.barcode&&this.props.barcode!==this.state.barcode?Object(d.jsx)(S.a,{to:"/products/"+this.state.barcode}):Object(d.jsxs)("div",{className:"code-reader-container",children:[Object(d.jsx)("span",{className:"close",onClick:function(){e.state.Quagga&&e.state.Quagga.stop(),e.props.showScanner(!1)},children:"\xd7"}),this.displayBarCode()]})}}]),a}(o.Component)),N=a(16),I=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={showScanner:!1,barcode:void 0,bcProductId:void 0,height:0},e.updateWindowDimensions=function(){e.setState({height:window.innerHeight})},e.handleScannerButton=function(t){e.setState({showScanner:t})},e.render=function(){return e.state.height<550?Object(d.jsx)(i.a.Fragment,{}):e.state.showScanner?Object(d.jsx)(k,{showScanner:e.handleScannerButton,history:e.props.history}):Object(d.jsx)(i.a.Fragment,{children:Object(d.jsxs)("div",{className:"navbar-container",children:[Object(d.jsx)(N.b,{to:"/history",className:"/history"===window.location.pathname?"navbar-link navbar-text-left navbar-selected":"navbar-link navbar-text-left ",children:Object(d.jsx)(l,{})}),Object(d.jsx)("div",{onClick:function(){return e.handleScannerButton(!0)},children:Object(d.jsx)("div",{className:"navbar-circle",children:Object(d.jsx)(b,{})})}),Object(d.jsx)("span",{className:"navbar-scan-text",children:"Scan"}),Object(d.jsx)(N.b,{to:"/profil",className:"/profil"===window.location.pathname?"navbar-link navbar-text-right navbar-selected":"navbar-link navbar-text-right ",children:Object(d.jsx)(u,{})})]})})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}}]),a}(i.a.Component);t.a=I},43:function(e,t,a){"use strict";a(52);var n=a(41),r=a(47),s=a(0),c=a.n(s),o=a(1);t.a=function(e){return Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{children:Object(o.jsx)("img",{src:r.a,className:"blob-top",alt:"Blob"})}),e.history?Object(o.jsx)(c.a.Fragment,{}):Object(o.jsxs)(c.a.Fragment,{children:[Object(o.jsx)("div",{children:Object(o.jsx)("img",{src:r.a,className:"blob-left",alt:"Blob"})}),Object(o.jsx)("div",{children:Object(o.jsx)("img",{src:r.a,className:"blob-right",alt:"Blob"})})," "]}),Object(o.jsxs)("div",{className:"header-container",children:[Object(o.jsx)("img",{src:n.a,className:"header-logo",alt:"Logo"}),Object(o.jsx)("span",{children:"Lowympact"})]})]})}},44:function(e,t,a){"use strict";t.a=a.p+"static/media/fruits-vegetables-basket-by-oblik-studio.7d5e1c64.svg"},47:function(e,t,a){"use strict";t.a=a.p+"static/media/bitmap.6f490d5b.png"},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},58:function(e,t){},59:function(e,t){},60:function(e,t){},61:function(e,t){},63:function(e,t){},64:function(e,t){},65:function(e,t){},66:function(e,t){},67:function(e,t){},68:function(e,t){},69:function(e,t){},70:function(e,t){}}]);
//# sourceMappingURL=9.559ee385.chunk.js.map