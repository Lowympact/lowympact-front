{"version":3,"sources":["components/Install/UseShouldShowPrompt.js","components/Install/UseIosInstallPrompt.js","components/Install/UseWebInstallPrompt.js","components/Install/InstallPWA.js","components/Button/ButtonSignin.js","pages/Signin.js","assets/images/fruits-vegetables-basket-by-oblik-studio.svg"],"names":["setInstallPromptSeenToday","promptName","today","moment","toISOString","localStorage","setItem","getUserShouldBePromptedToInstall","daysToWaitBeforePromptingAgain","lastPrompt","getItem","getInstallPromptLastSeenAt","daysSinceLastPrompt","diff","isNaN","UseShouldShowPrompt","useState","userShouldBePromptedToInstall","setUserShouldBePromptedToInstall","handleUserSeeingInstallPrompt","isIOS","navigator","standalone","ua","window","userAgent","isIPad","match","isIPhone","UseIosInstallPrompt","useShouldShowPrompt","UseWebInstallPrompt","installPromptEvent","setInstallPromptEvent","useEffect","beforeInstallPromptHandler","event","preventDefault","addEventListener","removeEventListener","prompt","userChoice","then","choice","outcome","InstallPWA","useIosInstallPrompt","iosInstallPrompt","handleIOSInstallDeclined","useWebInstallPrompt","webInstallPrompt","handleWebInstallDeclined","handleWebInstallAccepted","className","style","borderTopRightRadius","borderTopLeftRadius","backgroundColor","marginTop","width","src","alt","onClick","ButtonSignin","Signin","props","handleSubmit","e","state","errors","email","password","length","push","validate","setState","Connect","componentDidMount","Verify","isExpired","token","decodedToken","jwt","decode","complete","dateNow","Date","payload","exp","getTime","redirect","fetch","method","headers","body","JSON","stringify","response","json","data","error","loginSuccessful","err","success","_id","onPasswordChange","passwordInput","value","emailInput","this","to","Fragment","Header","fruits","onChange","ref","type","Component"],"mappings":"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","file":"static/js/13.687af37b.chunk.js","sourcesContent":["import { useState } from \"react\";\nimport moment from \"moment\";\n\nconst getInstallPromptLastSeenAt = (promptName) => localStorage.getItem(promptName);\n\nconst setInstallPromptSeenToday = (promptName) => {\n    const today = moment().toISOString();\n    localStorage.setItem(promptName, today);\n};\n\nfunction getUserShouldBePromptedToInstall(promptName, daysToWaitBeforePromptingAgain) {\n    const lastPrompt = moment(getInstallPromptLastSeenAt(promptName));\n    const daysSinceLastPrompt = moment().diff(lastPrompt, \"days\");\n    return isNaN(daysSinceLastPrompt) || daysSinceLastPrompt > daysToWaitBeforePromptingAgain;\n}\n\nconst UseShouldShowPrompt = (promptName, daysToWaitBeforePromptingAgain = 30) => {\n    const [userShouldBePromptedToInstall, setUserShouldBePromptedToInstall] = useState(\n        getUserShouldBePromptedToInstall(promptName, daysToWaitBeforePromptingAgain)\n    );\n\n    const handleUserSeeingInstallPrompt = () => {\n        setUserShouldBePromptedToInstall(false);\n        setInstallPromptSeenToday(promptName);\n    };\n\n    return [userShouldBePromptedToInstall, handleUserSeeingInstallPrompt];\n};\nexport default UseShouldShowPrompt;\n","import useShouldShowPrompt from \"./UseShouldShowPrompt\";\n\nconst iosInstallPromptedAt = \"iosInstallPromptedAt\";\n\nconst isIOS = () => {\n    // @ts-ignore\n    if (navigator.standalone) {\n        //user has already installed the app\n        return false;\n    }\n    const ua = window.navigator.userAgent;\n    const isIPad = !!ua.match(/iPad/i);\n    const isIPhone = !!ua.match(/iPhone/i);\n    return isIPad || isIPhone;\n};\n\nconst UseIosInstallPrompt = () => {\n    const [userShouldBePromptedToInstall, handleUserSeeingInstallPrompt] =\n        useShouldShowPrompt(iosInstallPromptedAt);\n\n    return [isIOS() && userShouldBePromptedToInstall, handleUserSeeingInstallPrompt];\n};\nexport default UseIosInstallPrompt;\n","import { useState, useEffect } from \"react\";\nimport useShouldShowPrompt from \"./UseShouldShowPrompt\";\n\nconst webInstallPromptedAt = \"webInstallPromptedAt\";\n\nconst UseWebInstallPrompt = () => {\n    const [installPromptEvent, setInstallPromptEvent] = useState();\n    const [userShouldBePromptedToInstall, handleUserSeeingInstallPrompt] =\n        useShouldShowPrompt(webInstallPromptedAt);\n\n    useEffect(() => {\n        const beforeInstallPromptHandler = (event) => {\n            event.preventDefault();\n\n            // check if user has already been asked\n            if (userShouldBePromptedToInstall) {\n                // store the event for later use\n                setInstallPromptEvent(event);\n                localStorage.setItem(\"installPrompt\", event);\n            }\n        };\n        window.addEventListener(\"beforeinstallprompt\", beforeInstallPromptHandler);\n        return () => window.removeEventListener(\"beforeinstallprompt\", beforeInstallPromptHandler);\n    }, [userShouldBePromptedToInstall]);\n\n    const handleInstallDeclined = () => {\n        handleUserSeeingInstallPrompt();\n        setInstallPromptEvent(null);\n    };\n\n    const handleInstallAccepted = () => {\n        // show native prompt\n        prompt = localStorage.getItem(\"installPrompt\");\n        prompt.prompt();\n\n        // decide what to do after the user chooses\n        prompt.userChoice.then((choice) => {\n            // if the user declined, we don't want to show the prompt again\n            if (choice.outcome !== \"accepted\") {\n                handleUserSeeingInstallPrompt();\n            }\n            localStorage.getItem(\"installPrompt\", null);\n        });\n    };\n    return [installPromptEvent, handleInstallDeclined, handleInstallAccepted];\n};\nexport default UseWebInstallPrompt;\n","import React from \"react\";\nimport useIosInstallPrompt from \"./UseIosInstallPrompt\";\nimport useWebInstallPrompt from \"./UseWebInstallPrompt\";\nimport \"./InstallPWA.css\";\n\nconst InstallPWA = () => {\n    const [iosInstallPrompt, handleIOSInstallDeclined] = useIosInstallPrompt();\n    const [webInstallPrompt, handleWebInstallDeclined, handleWebInstallAccepted] =\n        useWebInstallPrompt();\n\n    if (!iosInstallPrompt && !webInstallPrompt) {\n        return null;\n    }\n    return (\n        <div className=\"install-popup\">\n            <div className=\"install-popup-wrapper\">\n                <img\n                    className=\"mx-auto\"\n                    style={{\n                        borderTopRightRadius: \"50%\",\n                        borderTopLeftRadius: \"50%\",\n                        backgroundColor: \"#fff\",\n                        marginTop: \"-50px\",\n                    }}\n                    width=\"100px\"\n                    src=\"pwa-512x512.png\"\n                    alt=\"Icon\"\n                />\n                <div>\n                    {iosInstallPrompt && (\n                        <>\n                            <div className=\"text-center\">\n                                <h3>Téléchargez l'application</h3>\n                            </div>\n                            <div className=\"text-center\">\n                                Cliquez sur {\"  \"}\n                                <span className=\"material-icons\">ios_share</span>\n                                {\"  \"}puis &quot;Ajouter à l'écran d'accueil&quot;\n                            </div>\n                            <div className=\"button-dissmiss\">\n                                <button onClick={handleIOSInstallDeclined}>Pas maintenant</button>\n                            </div>\n                        </>\n                    )}\n                    {webInstallPrompt && (\n                        <>\n                            <div className=\"text-center\">\n                                <h3>Ne passez plus à côté des alternatives durables</h3>\n                            </div>\n                            <div className=\"android-wrapper\">\n                                <button\n                                    className=\"install-button\"\n                                    onClick={handleWebInstallAccepted}\n                                >\n                                    Installer l'application\n                                </button>\n                                <button\n                                    className=\"dont-install-button\"\n                                    onClick={handleWebInstallDeclined}\n                                >\n                                    Pas maintenant\n                                </button>\n                            </div>\n                        </>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default InstallPWA;\n","import React from \"react\";\n\nfunction ButtonSignin() {\n  return (\n  <div>\n    Me connecter\n  </div>\n  );\n}\n\nexport default ButtonSignin;","import React, { Component } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport ButtonSignin from \"../components/Button/ButtonSignin\";\nimport fruits from \"../assets/images/fruits-vegetables-basket-by-oblik-studio.svg\";\nimport Header from \"../components/Header/Header\";\nimport blob from \"../assets/images/bitmap.png\";\nimport \"./Login.css\";\nimport { Link } from \"react-router-dom\";\nimport jwt from \"jsonwebtoken\";\nimport InstallPWA from \"../components/Install/InstallPWA\";\n\nfunction validate(email, password) {\n    const errors = [];\n\n    if (email.length === 0) {\n        errors.push(<p>Saissez votre adresse e-mail</p>);\n    }\n    if (password.length === 0) {\n        errors.push(<p>Saissez votre mot de passe</p>);\n    }\n    return errors;\n}\n\nclass Signin extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            email: \"\",\n            password: \"\",\n            errors: [],\n            redirect: false,\n            loginSuccessful: null,\n        };\n    }\n\n    handleSubmit = (e) => {\n        e.preventDefault();\n        const { email, password } = this.state;\n        const errors = validate(email, password);\n        ////console.log(email, password, errors);\n        this.setState({ errors });\n        if (errors.length === 0) {\n            this.Connect();\n        }\n    };\n\n    componentDidMount = () => {\n        this.Verify();\n    };\n\n    Verify = () => {\n        let isExpired = true;\n        const token = localStorage.getItem(\"token\");\n        if (token) {\n            var decodedToken = jwt.decode(token, { complete: true });\n            var dateNow = new Date();\n            if (decodedToken.payload.exp >= dateNow.getTime() / 1000) {\n                isExpired = false;\n            }\n        }\n        if (isExpired === false) {\n            this.setState({ redirect: true }); // redirection vers la page login\n        }\n    };\n\n    Connect = () => {\n        fetch(`https://api.lowympact.fr/api/v1/users/login`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"api-key\": \"99d8fb95-abdd-4885-bf6c-3a81d8874043\",\n\n                //'x-access-token': localStorage.getItem('token'),\n            },\n            body: JSON.stringify({\n                email: this.state.email,\n                password: this.state.password,\n            }),\n        })\n            .then((response) => response.json())\n            .then((data) => {\n                ////console.log(data);\n                if (data.error === \"No user found\") {\n                    this.setState({ loginSuccessful: false });\n                    let err = this.state.errors;\n                    err.push(<p>Utilisateur Inconnu</p>);\n                    this.setState({ errors: err });\n                } else if (data.error === \"Incorrect password\" || !data.success) {\n                    this.setState({ loginSuccessful: false });\n                    let err = this.state.errors;\n                    err.push(<p>Mot de passe Incorrect</p>);\n                    this.setState({ errors: err });\n                } else {\n                    // //console.log(data);\n                    localStorage.setItem(\"token\", data.token);\n                    localStorage.setItem(\"userId\", data._id);\n                    this.setState({ loginSuccessful: true, redirect: true });\n                    //this.props.history.goBack();\t// a ajouter pour être redirigé vers la page initialement\n                    // demandée. On doit cependant rediriger si la page demandée\n                    // était la page de login\n                }\n            });\n    };\n\n    onPasswordChange = () => {\n        this.setState({\n            password: this.passwordInput.value,\n            email: this.emailInput.value,\n        });\n    };\n\n    render() {\n        if (this.state.redirect) {\n            return <Redirect to=\"/history\" />;\n        }\n        return (\n            <React.Fragment>\n                <Link to=\"/login\">\n                    <Header />\n                </Link>\n                <div className=\"logo-fruits\">\n                    <img src={fruits} className=\"logo\" alt=\"Fruits\" />\n                </div>\n\n                <Link className=\"back-button\" to=\"/login\">\n                    {\"< Retour\"}\n                </Link>\n                <div className=\"signin-container\">\n                    <form className=\"forms\">\n                        <label>\n                            email\n                            <input\n                                className=\"input-forms\"\n                                value={this.state.email}\n                                onChange={this.onPasswordChange}\n                                ref={(ref) => (this.emailInput = ref)}\n                                type=\"email\"\n                            />\n                        </label>\n                        <label>\n                            mot de passe\n                            <input\n                                className=\"input-forms\"\n                                value={this.state.password}\n                                onChange={this.onPasswordChange}\n                                ref={(ref) => (this.passwordInput = ref)}\n                                type=\"password\"\n                            />\n                        </label>\n                    </form>\n                    <label className=\"errors-signin\">{this.state.errors}</label>\n                    <div className=\"button-signin\" onClick={this.handleSubmit}>\n                        <ButtonSignin />\n                    </div>\n                </div>\n                <InstallPWA />\n            </React.Fragment>\n        );\n    }\n}\nexport default Signin;\n","export default __webpack_public_path__ + \"static/media/fruits-vegetables-basket-by-oblik-studio.7d5e1c64.svg\";"],"sourceRoot":""}