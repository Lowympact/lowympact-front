{"version":3,"sources":["pages/Avis.js"],"names":["Avis","state","value","sent","componentDidMount","Verify","isExpired","token","localStorage","getItem","decodedToken","jwt","decode","complete","dateNow","Date","payload","exp","getTime","clear","props","history","push","setValue","input","setState","target","send","userId","fetch","method","credentials","headers","Headers","Authorization","body","JSON","stringify","message","then","response","json","res","console","log","success","render","button","Fragment","onClick","to","className","placeholder","maxLength","onChange","React","Component"],"mappings":"2OAOMA,E,4MACFC,MAAQ,CACJC,MAAO,GACPC,KAAM,G,EAGVC,kBAAoB,WAChB,EAAKC,U,EAGTA,OAAS,WACL,IAAIC,GAAY,EACVC,EAAQC,aAAaC,QAAQ,SACnC,GAAIF,EAAO,CACP,IAAIG,EAAeC,IAAIC,OAAOL,EAAO,CAAEM,UAAU,IAC7CC,EAAU,IAAIC,KACdL,EAAaM,QAAQC,KAAOH,EAAQI,UAAY,MAChDZ,GAAY,IAGF,IAAdA,IACAE,aAAaW,QACb,EAAKC,MAAMC,QAAQC,KAAK,Y,EAIhCC,SAAW,SAACC,GACR,EAAKC,SAAS,CAAEvB,MAAOsB,EAAME,OAAOxB,S,EAGxCyB,KAAO,WACH,IAAIC,EAASpB,aAAaC,QAAQ,UAClC,EAAKgB,SAAS,CAAEtB,KAAM,IAClByB,GACAC,MAAM,yCAAD,OACwCD,EADxC,WAGD,CACIE,OAAQ,MACRC,YAAa,UACbC,QAAS,IAAIC,QAAQ,CACjBC,cAAe1B,aAAaC,QAAQ,SACpC,UAAW,uCACX,eAAgB,qBAEpB0B,KAAMC,KAAKC,UAAU,CACjBC,QAAS,EAAKrC,MAAMC,UAI3BqC,MAAK,SAACC,GAAD,OAAcA,EAASC,UAC5BF,MAAK,SAACG,GACHC,QAAQC,IAAIF,GACRA,EAAIG,QACJ,EAAKpB,SAAS,CAAEtB,KAAM,IAEtB,EAAKsB,SAAS,CAAEtB,KAAM,Q,EAM1C2C,OAAS,WACL,IAAIC,EAAS,cAAC,IAAMC,SAAP,IAab,OAZuB,GAAnB,EAAK/C,MAAME,OACX4C,EAAS,wBAAQE,QAAS,EAAKtB,KAAtB,yBAEU,GAAnB,EAAK1B,MAAME,OACX4C,EAAS,sDAEU,GAAnB,EAAK9C,MAAME,OACX4C,EAAS,8DAEU,GAAnB,EAAK9C,MAAME,OACX4C,EAAS,2FAGT,gCACI,cAAC,IAAD,CAAMG,GAAG,IAAT,SACI,cAAC,IAAD,MAGJ,cAAC,IAAD,IACA,qBAAKC,UAAU,iBAAf,SACI,sBAAKA,UAAU,OAAf,UACI,sEACA,mKAIA,uHAC4E,OAE5E,0BACIC,YAAY,6BACZC,UAAW,IACXnD,MAAO,EAAKD,MAAMC,MAClBoD,SAAU,EAAK/B,WAElBwB,W,YAnGNQ,IAAMC,WA2GVxD,a","file":"static/js/17.5e3d4c74.chunk.js","sourcesContent":["import React from \"react\";\nimport \"./Avis.css\";\nimport { Link } from \"react-router-dom\";\nimport Header from \"../components/Header/Header\";\nimport Navbar from \"../components/Navbar/Navbar\";\nimport jwt from \"jsonwebtoken\";\n\nclass Avis extends React.Component {\n    state = {\n        value: \"\",\n        sent: 0,\n    };\n\n    componentDidMount = () => {\n        this.Verify();\n    };\n\n    Verify = () => {\n        let isExpired = true;\n        const token = localStorage.getItem(\"token\");\n        if (token) {\n            var decodedToken = jwt.decode(token, { complete: true });\n            var dateNow = new Date();\n            if (decodedToken.payload.exp >= dateNow.getTime() / 1000) {\n                isExpired = false;\n            }\n        }\n        if (isExpired === true) {\n            localStorage.clear();\n            this.props.history.push(\"/login\");\n        }\n    };\n\n    setValue = (input) => {\n        this.setState({ value: input.target.value });\n    };\n\n    send = () => {\n        let userId = localStorage.getItem(\"userId\");\n        this.setState({ sent: 1 });\n        if (userId) {\n            fetch(\n                `https://api.lowympact.fr/api/v1/users/${userId}/review`,\n                // `http://localhost:8080/api/v1/users/${this.state.userId}/history`,\n                {\n                    method: \"put\",\n                    credentials: \"include\",\n                    headers: new Headers({\n                        Authorization: localStorage.getItem(\"token\"),\n                        \"api-key\": \"99d8fb95-abdd-4885-bf6c-3a81d8874043\",\n                        \"Content-Type\": \"application/json\",\n                    }),\n                    body: JSON.stringify({\n                        message: this.state.value,\n                    }),\n                }\n            )\n                .then((response) => response.json())\n                .then((res) => {\n                    console.log(res);\n                    if (res.success) {\n                        this.setState({ sent: 2 });\n                    } else {\n                        this.setState({ sent: 3 });\n                    }\n                });\n        }\n    };\n\n    render = () => {\n        let button = <React.Fragment />;\n        if (this.state.sent == 0) {\n            button = <button onClick={this.send}>Envoyer ! </button>;\n        }\n        if (this.state.sent == 1) {\n            button = <div>Envoi en cours ...</div>;\n        }\n        if (this.state.sent == 2) {\n            button = <div> Message bien envoyé ! </div>;\n        }\n        if (this.state.sent == 3) {\n            button = <div>Erreur de réseau, merci de réessayer plus tard :/</div>;\n        }\n        return (\n            <div>\n                <Link to=\"/\">\n                    <Header />\n                </Link>\n\n                <Navbar />\n                <div className=\"avis-container\">\n                    <div className=\"avis\">\n                        <h2>Votre avis est important pour nous !</h2>\n                        <p>\n                            Cette application est le résultat d'un petit projet de 6 étudiants\n                            Lyonnais, et à besoin de nombreuses améliorations !\n                        </p>\n                        <p>\n                            Vos retours nous aident à nous améliorer, n'hésitez pas à nous écrire !{\" \"}\n                        </p>\n                        <textarea\n                            placeholder=\" Donnez-nous votre avis ! \"\n                            maxLength={500}\n                            value={this.state.value}\n                            onChange={this.setValue}\n                        ></textarea>\n                        {button}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n}\n\nexport default Avis;\n"],"sourceRoot":""}