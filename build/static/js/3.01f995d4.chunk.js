(this.webpackJsonplowympact=this.webpackJsonplowympact||[]).push([[3],{46:function(e,t,a){"use strict";var n=a(43),s=a.n(n),r=a(44),c=a(13),i=a(16),o=a(15),d=a(14),l=(a(59),a(0)),u=a.n(l),j=(a(60),a(1));var h=function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"button-logo",children:Object(j.jsx)("span",{className:"material-icons",children:"history"})}),Object(j.jsx)("div",{children:"Historique"})]})};var p=function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{children:Object(j.jsx)("span",{className:"material-icons",children:"person"})}),Object(j.jsx)("div",{children:"Profil"})]})};var b=function(){return Object(j.jsx)("div",{children:Object(j.jsx)("div",{className:"navbar-scan-icon",children:Object(j.jsx)("span",{className:"material-icons",children:"qr_code_scanner"})})})},m=a(99),g=a(100),v=a.n(g),x=a(101),f=a.n(x),O=function(e){Object(o.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={error:!1,noBackCamera:!1,usedCamera:0,devices:[],processingImage:0,text:0,mutlipleTracks:!1,no_permission:!1,locked:!1},e.locked=!1,e.switchCamera=Object(r.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.state.locked){t.next=10;break}return e.setState({locked:!0}),(a=e.state.usedCamera+1)>=e.state.devices.length&&(a=0),e.setState({usedCamera:a}),v.a.stop(),e.QuaggaInit(e.state.devices[a].deviceId),t.next=9,w(800);case 9:e.setState({locked:!1});case 10:case"end":return t.stop()}}),t)}))),e.componentDidMount=Object(r.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.capabilities?(e.setState({devices:e.props.capabilities,usedCamera:0}),e.QuaggaInit(e.props.capabilities[0])):e.QuaggaInit({facingMode:"environment"});case 1:case"end":return t.stop()}}),t)}))),e.QuaggaInit=function(t){console.log(t),0==Object.keys(t).length&&e.setState({text:"vide"}),v.a.init({inputStream:{type:"LiveStream",constraints:Object(m.a)({},t)},locator:{patchSize:"normal",halfSample:!1},locate:!1,area:{top:"40%",right:"25%",left:"25%",bottom:"40%"},numOfWorkers:window.navigator.hardwareConcurrency||2,decoder:{readers:["ean_reader"]},multiple:!1,singleChannel:!1},(function(a){if(a)return console.log(a),"NotAllowedError: Permission denied"==a&&e.setState({no_permission:!0}),e.setState({error:!0,text:a+" "+JSON.stringify(t)}),!1;v.a.start()})),e.props.setQuagga(v.a),console.log(v.a.CameraAccess),v.a.onDetected(e._onDetected)},e._onDetected=function(){var t=Object(r.a)(s.a.mark((function t(a){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.onDetected(a);case 2:n=t.sent,console.log(n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onDrop=function(t){try{if(1!=e.state.processingImage){e.setState({processingImage:1}),console.log(t[t.length-1]);var a=new FileReader;a.readAsDataURL(t[t.length-1]),a.onloadend=function(){v.a.decodeSingle({decoder:{readers:["ean_reader"]},locate:!0,src:a.result},(function(t){var a;(console.log(t),t)?(e._onDetected(t),e.setState({processingImage:2}),console.log("result",null===(a=t.codeResult)||void 0===a?void 0:a.code)):(console.log("not detected"),e.setState({processingImage:3}))}))}}}catch(n){console.log(n),e.setState({processingImage:4})}},e.setImport=function(){e.setState({error:!e.state.error})},e}return Object(i.a)(a,[{key:"componentWillUnmount",value:function(){v.a.offDetected(this._onDetected)}},{key:"render",value:function(){var e,t=Object(j.jsx)(u.a.Fragment,{});return 1==this.state.processingImage&&(t=Object(j.jsx)(u.a.Fragment,{children:Object(j.jsx)("p",{children:"Chargement en cours..."})})),2==this.state.processingImage&&(t=Object(j.jsx)(u.a.Fragment,{children:Object(j.jsx)("p",{children:"Ce produit n'existe pas dans la base de donn\xe9es"})})),3==this.state.processingImage&&(t=Object(j.jsx)(u.a.Fragment,{children:Object(j.jsx)("p",{children:"Code barre non trouv\xe9 sur l'image, merci de r\xe9essayer"})})),4==this.state.processingImage&&(t=Object(j.jsx)(u.a.Fragment,{children:Object(j.jsxs)("p",{children:["Mauvais format ou fichier trop grand, merci de r\xe9essayer. ",Object(j.jsx)("br",{}),"Taille max : 5mb ",Object(j.jsx)("br",{}),"Formats: jpg, png, gif"]})})),Object(j.jsx)(u.a.Fragment,{children:Object(j.jsxs)("div",{className:"interactive-wrapper",children:[Object(j.jsxs)("div",{id:"interactive",className:this.state.error?"hidden":"viewport",children:[Object(j.jsx)("div",{className:"a"}),Object(j.jsx)("div",{className:"b"}),Object(j.jsx)("div",{className:"c"}),Object(j.jsx)("div",{className:"d"})]}),(null===(e=this.state.devices)||void 0===e?void 0:e.length)>1?Object(j.jsxs)("button",{className:"code-switch-camera",onClick:this.switchCamera,children:[Object(j.jsx)("span",{className:"material-icons",style:{color:this.state.locked?"#777777":"#1b3044"},children:"cameraswitch"}),this.state.usedCamera]}):Object(j.jsx)(u.a.Fragment,{}),this.state.error?Object(j.jsxs)("div",{className:"scan-error",children:[Object(j.jsx)(f.a,{withIcon:!0,withPreview:!1,buttonText:Object(j.jsxs)("div",{className:"button-import",children:[Object(j.jsx)("div",{className:"material-icons",children:"add_a_photo"}),Object(j.jsx)("p",{children:"Importer une photo"})]}),onChange:this.onDrop,label:"",imgExtension:[".jpg",".gif",".png",".jpeg"],maxFileSize:5242880,labelClass:"import-label"}),Object(j.jsx)("p",{className:"red",children:t}),Object(j.jsxs)("p",{className:"error-message-import",children:[this.state.no_permission?Object(j.jsx)("div",{className:"no-permission",children:"L'acc\xe8s \xe0 votre cam\xe9ra est bloqu\xe9 : Vous pouvez l'autoriser dans les param\xe8tres de votre navigateur pour acc\xe9der au scanner"}):Object(j.jsx)(u.a.Fragment,{}),Object(j.jsx)("br",{})]})]}):Object(j.jsx)(u.a.Fragment,{}),this.state.mutlipleTracks?Object(j.jsx)("h1",{className:"debug",children:"If you see this, tell me"}):"",Object(j.jsx)("div",{className:"debug",children:this.state.text})]})})}}]),a}(l.Component),w=function(e){return new Promise((function(t){return setTimeout(t,e)}))},S=a(102),y=a.n(S),N=a(17),k=(a(61),a(56),function(e){Object(o.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={scanning:!0,status:"",results:[],usedCameraId:"3f6fc4177028f25c3e8215f4444838450630b8d656c627ef511346545d37f302",devices:[],reading:!1,barcode:void 0,bcProductId:void 0,Quagga:void 0,product:void 0,online:window.navigator.onLine},e.componentDidMount=function(){window.addEventListener("offline",e.updateNetwork),window.addEventListener("online",e.updateNetwork)},e.updateNetwork=function(){e.setState({online:window.navigator.onLine})},e.setQuagga=function(t){e.state.Quagga&&e.state.Quagga.stop(),e.setState({Quagga:t})},e._onDetected=function(){var t=Object(r.a)(s.a.mark((function t(a){var n,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=18;break}if(console.log(a),!a.codeResult||!a.codeResult.code){t.next=18;break}return e.setState({results:[a],scanning:!0,status:"waiting"}),t.next=6,fetch("https://world.openfoodfacts.org/api/v0/product/".concat(a.codeResult.code,".json/"));case 6:return n=t.sent,t.next=9,n.json();case 9:if(c=t.sent,console.log(c),0===c.status){t.next=16;break}return e.setState({scanning:!0,status:"found",product:c,barcode:a.codeResult.code}),t.abrupt("return",!0);case 16:return e.setState({scanning:!0,status:"not found"},Object(r.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I(3e3);case 2:e.setState({scanning:!0,status:void 0});case 3:case"end":return t.stop()}}),t)})))),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleScan=function(t){if(t){var a=t.split("/");a.length>1&&e.setState({scanning:!1,barcode:a[4],bcProductId:a[5],status:"found"})}},e.handleError=function(e){console.error(e)},e.displayQrCode=function(){return"found"!==e.state.status?Object(j.jsx)(y.a,{delay:300,onError:e.handleError,onScan:e.handleScan,style:{width:"100%"},showViewFinder:!1}):Object(j.jsx)(u.a.Fragment,{})},e.displayBarCode=function(){return Object(j.jsx)(u.a.Fragment,{children:e.state.scanning?Object(j.jsx)(O,{onDetected:e._onDetected,setQuagga:e.setQuagga,usedCameraId:e.usedCameraId,capabilities:e.props.capabilities}):null})},e.switchReader=function(){e.state.reading?e.setState({reading:!1}):(e.state.Quagga&&e.state.Quagga.stop(),e.setState({reading:!0}))},e.displayPopup=function(){var t;console.log(e.state.product);var a=Object(j.jsx)(u.a.Fragment,{}),n=null===(t=e.state.product)||void 0===t?void 0:t.product;return n?a=Object(j.jsxs)(N.b,{className:"history-item",to:"/products/"+e.state.product.code,onClick:function(){e.state.Quagga&&e.state.Quagga.stop(),e.props.showScanner(!1)},children:[Object(j.jsx)("div",{className:"history-img-container",children:Object(j.jsx)("img",{src:n.image_url,alt:""})}),Object(j.jsxs)("div",{className:"history-name-container",children:[Object(j.jsx)("div",{className:"history-name",children:n.product_name}),Object(j.jsx)("div",{className:"history-brand",children:n.brands})]}),Object(j.jsxs)("div",{className:"history-label-container",children:[Object(j.jsx)("div",{style:{color:C(n.ecoscore_score)},children:"\u25cf"}),Object(j.jsx)("div",{className:"history-label",children:-1==["a","b","c","d","e"].indexOf(n.ecoscore_grade)?"":n.ecoscore_grade})]}),Object(j.jsx)("div",{style:{marginRight:"10px",color:"rgb(41,72,102)"},children:">"})]}):"waiting"==e.state.status?a=Object(j.jsx)("div",{className:"history-item",children:Object(j.jsx)("div",{class:"skeleton-8wwpnkj1sj9"})}):"not found"==e.state.status&&(a=Object(j.jsxs)("div",{className:"history-item",children:[Object(j.jsx)("div",{className:"history-img-container",children:Object(j.jsx)("div",{className:"grey-square"})}),Object(j.jsxs)("div",{className:"history-name-container",children:[Object(j.jsx)("div",{className:"history-name",children:"Article non trouv\xe9"}),Object(j.jsx)("div",{className:"history-brand"})]}),Object(j.jsx)("div",{className:"history-label-container"}),Object(j.jsx)("div",{style:{marginRight:"10px",color:"rgb(41,72,102)"},children:">"})]})),a},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:this.props.hideScannerAnimation?"code-reader-container hide-scanner":"code-reader-container",children:[this.state.online?Object(j.jsx)(u.a.Fragment,{}):Object(j.jsxs)("div",{className:"offline-container",children:[" ",Object(j.jsx)("span",{style:{color:"red"},children:"\u25cf"})," Pas de connexion"]}),Object(j.jsx)("span",{className:"close material-icons",onClick:function(){e.state.Quagga&&e.state.Quagga.stop(),e.props.showScanner(!1)},children:"close"}),this.displayBarCode(),Object(j.jsx)("div",{className:"scan-result-container",children:Object(j.jsx)("div",{className:"results",children:this.displayPopup()})})]})}}]),a}(l.Component));function C(e){return e>67?"green":e<=33?"red":"yellow"}var I=function(e){return new Promise((function(t){return setTimeout(t,e)}))},D=function(e){Object(o.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={showScanner:!1,barcode:void 0,bcProductId:void 0,height:0,capabilities:void 0,hideScannerAnimation:!1},e.componentDidMount=Object(r.a)(s.a.mark((function t(){var a,n,c,i,o,d;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.updateWindowDimensions(),window.addEventListener("resize",e.updateWindowDimensions),t.prev=2,a=window.location.search,n=new URLSearchParams(a),n.get("camera"),!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)){t.next=21;break}return t.next=9,navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"videoinput"===e.kind}))}));case 9:return c=t.sent,0===(i=c.filter((function(e){return null!=e.label.match(/back/)}))).length&&(i=c),console.log(i),o=i.map(function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:t.deviceId}}}).then((function(e){var t=e.getVideoTracks().map((function(e){return console.log(e),e.getCapabilities?e.getCapabilities():[{}]}));return e.getTracks().forEach((function(e){return e.stop()})),t&&t.length>0?t[0]:{}}),(function(e){return console.log(e)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.next=16,Promise.all(o);case 16:(d=t.sent)&&d.length>0&&d.sort((function(e,t){return(e.width.max+e.height.max)/2>(t.width.max+t.height.max)/2?-1:1})),d[0]?e.setState({capabilities:d}):e.setState({capabilities:void 0}),t.next=22;break;case 21:e.setState({capabilities:void 0});case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(2),e.setState({capabilities:void 0});case 27:case"end":return t.stop()}}),t,null,[[2,24]])}))),e.updateWindowDimensions=function(){e.setState({height:window.innerHeight})},e.handleScannerButton=function(t){!1===t?e.setState({hideScannerAnimation:!0},Object(r.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,_(300);case 2:e.setState({showScanner:t,hideScannerAnimation:!1});case 3:case"end":return a.stop()}}),a)})))):e.setState({showScanner:t})},e.render=function(){return e.state.height<550?Object(j.jsx)(u.a.Fragment,{}):e.state.showScanner?Object(j.jsx)(k,{hideScannerAnimation:e.state.hideScannerAnimation,showScanner:e.handleScannerButton,history:e.props.history,capabilities:e.state.capabilities}):Object(j.jsx)(u.a.Fragment,{children:Object(j.jsxs)("div",{className:"navbar-container",children:[Object(j.jsx)(N.b,{to:"/history",className:"/history"===window.location.pathname?"navbar-link navbar-text-left navbar-selected":"navbar-link navbar-text-left ",children:Object(j.jsx)(h,{})}),Object(j.jsx)("div",{onClick:function(){return e.handleScannerButton(!0)},children:Object(j.jsx)("div",{className:"navbar-circle",children:Object(j.jsx)(b,{})})}),Object(j.jsx)("span",{className:"navbar-scan-text",children:"Scan"}),Object(j.jsx)(N.b,{to:"/profil",className:"/profil"===window.location.pathname?"navbar-link navbar-text-right navbar-selected":"navbar-link navbar-text-right ",children:Object(j.jsx)(p,{})})]})})},e}return Object(i.a)(a,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}}]),a}(u.a.Component),_=(t.a=D,function(e){return new Promise((function(t){return setTimeout(t,e)}))})},56:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){}}]);
//# sourceMappingURL=3.01f995d4.chunk.js.map